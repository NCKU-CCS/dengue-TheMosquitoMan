Quintus.EnemySprites=function(t){t.gravityY=0,t.gravityX=0;var e=900;t.Sprite.extend("Mos_magic_circle",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2-100,asset:"level/mos_magic_circle.png",scale:.1,opacity:.1}),this.add("tween")}}),t.Sprite.extend("MosquitoTracker",{init:function(e){this._super(e,{x:t.width/2,y:70,scale:1,direct:"up"}),this.add("tween"),this.move(),this.on("inserted",this,"setupBlocks")},setupBlocks:function(){t._each(this.p.data,function(e,i){t._each(e,function(a,n){a&&5>a?this.stage.insert(new t.Enemy({mosType:a,x:80*n-80*(e.length/2-.5),y:50*i}),this):a>=5&&this.stage.insert(new t.MosKingAttack({mosType:a,x:40*n-40*(e.length/2-.5),y:40*i}),this)},this)},this)},move:function(){"up"==this.p.direct?this.animate({y:this.p.y-30},.6,t.Easing.Quadratic.InOut,{delay:.3,callback:function(){t("Enemy").trigger("call")}}):"down"==this.p.direct&&this.animate({y:this.p.y+30},.6,t.Easing.Quadratic.InOut,{delay:.3,callback:function(){t("MosKingAttack").trigger("call")}})}}),t.Sprite.extend("Enemy",{init:function(i){this._super(i,{sheet:"mos"+i.mosType,sprite:"enemy",collisionMask:t.SPRITE_ENEMY,mosId:GAME.ENEMY.mosId,opacity:.1,life:i.mosType,count:0}),this.add("tween"),this.on("attacked,call"),this.on("hit",this,"collide"),this.animate({opacity:1},.6,t.Easing.Quadratic.InOut),GAME.ENEMY.mosId++;var a=this;GAME.ENEMY.attackTimer.push(setInterval(function(){if(t.state.get("is_video_over")&&t.state.get("is_countdown_over")){var e=Math.round(Math.random()*GAME.ENEMY.RATE_mosAttack),i=t.select("Player").items[0].p.x,n=t.select("Player").items[0].p.y,s=i-a.c.x,o=n-a.c.y,r=Math.atan2(o,s)/Math.PI*180;1==e&&a.stage.insert(new t.MosAttack({x:a.c.x,y:a.c.y,vx:s>0?15:-15,vy:(s>0?15:-15)*o/s,angle:r-90}))}},e))},call:function(){this.c.y-=30},attacked:function(){if(this.p.life=this.p.life-1,this.p.life<=0){t.audio.play("damage.mp3");var e=this.p.sheet;switch(e){case"mos1":this.p.sheet="enemy_death";break;case"mos2":this.p.sheet="mos2_death";break;case"mos4":this.p.sheet="mos4_death";break;default:this.p.sheet="enemy_death"}clearInterval(GAME.ENEMY.attackTimer[this.p.mosId]),dropKatha(this.stage,this,20),this.animate({y:this.p.y+15,opacity:0},.15,t.Easing.Linear,{callback:function(){this.destroy()}})}},step:function(){this.stage.collide(this),t.state.get("is_countdown_over")&&(this.p.count++,this.p.count%GAME.ENEMY.mosSpeed==0&&(this.p.y+=20,this.c.y+=20,this.p.count=0)),this.p.y>t.height&&this.destroy()},collide:function(e){e.obj.isA("Player")&&(t.state.get("isPlayerAttack")||(t("Player").trigger("hurt"),t.state.dec("lives",1)),this.destroy(),clearInterval(GAME.ENEMY.attackTimer[this.p.mosId]))}}),t.Sprite.extend("Mosking_talk",{init:function(e){this._super(e,{x:t.width+200,y:100,sheet:"mosking_talk"}),this.add("tween"),this.animate({x:t.width/2+180},.3,t.Easing.Quadratic.InOut,{delay:.3})}}),t.Sprite.extend("Mosking_talk_frame",{init:function(e){this._super(e,{x:t.width/2-90,y:90,sheet:"mosking_talk_frame",scale:.1,angle:0,opacity:0}),this.add("tween"),this.animate({opacity:1,angle:720,scale:1},.3,t.Easing.Quadratic.InOut,{delay:.4})}}),t.Sprite.extend("Mosking_talk_text_2",{init:function(e){this._super(e,{x:t.width/2-100,y:90,asset:"level/mosking_talk_2.png",opacity:0}),this.add("tween")}}),t.Sprite.extend("Mosking_talk_text_3",{init:function(e){this._super(e,{x:t.width/2-100,y:90,asset:"level/mosking_talk_3.png",opacity:0}),this.add("tween")}}),t.Sprite.extend("MosAttack",{init:function(e){this._super(e,{sheet:"mosattack",sprite:"mosattack",collisionMask:t.SPRITE_ENEMY}),this.add("2d"),this.on("hit",this,"collide"),this.on("destroy,disappear")},step:function(e){this.p.x+=this.p.vx*e,this.p.y+=this.p.vy*e,this.stage.collide(this),this.p.y>t.height&&this.destroy()},disappear:function(){this.destroy()},collide:function(e){e.obj.isA("Player")?(t.state.get("isPlayerAttack")||(t("Player").trigger("hurt"),t.state.dec("lives",1)),this.destroy()):e.obj.isA("PlayerInvincible")&&(t.audio.play("player_invincible_attack.mp3"),this.destroy())}}),t.Sprite.extend("MosKing",{init:function(e){this._super(e,{sheet:"mosking_anim",sprite:"mosking_anim",collisionMask:t.SPRITE_ENEMY,x:t.width/2,y:110,scale:.1,opacity:1,life:t.state.get("mosking_life")});var i=this;this.on("destroy"),this.add("tween,animation"),this.animate({scale:1},.4,t.Easing.Quadratic.InOut),this.fly_up(),this.play("default"),window.setTimeout(function(){i.walk("right")},1e4),console.log("mosking_lifea: "+this.p.life)},walk:function(e){var i=this,a=this.p.w/2;"right"==e?(window.setTimeout(function(){i.walk("left")},6e3),this.animate({x:t.width-a},.6,t.Easing.Quadratic.InOut)):"left"==e&&(window.setTimeout(function(){i.walk("right")},6e3),this.animate({x:a},.6,t.Easing.Quadratic.InOut))},destroyed:function(){var e=this.p.x,i=this.p.y;this.p.life<=0&&(this.stage.trigger("complete"),t.audio.play("mosking_die_roar.mp3"),t("Player").trigger("destroy"),t("MosAttack").trigger("disappear"),resetAttackTimer()),t.audio.play("mosking_hurt.mp3"),this.stage.insert(new t.MosKing_die({x:e,y:i})),this.animate({opacity:0},.1,t.Easing.Linear),this.destroy()},fly_up:function(){this.animate({y:100},1,t.Easing.Quadratic.InOut,{callback:function(){this.fly_down()}})},fly_down:function(){this.animate({y:115},.5,t.Easing.Quadratic.InOut,{callback:function(){this.fly_up()}})}}),t.Sprite.extend("MosKing_die",{init:function(e){var i,a;this._super(e,{sheet:"mosking_die",sprite:"mosking_die",collisionMask:t.SPRITE_ENEMY,opacity:1}),this.add("tween"),this.opacity_0(),t.state.dec("mosking_life",1),i=t.state.get("mosking_life"),a=this.p.y,0>i?this.animate({y:this.p.y+200},2,t.Easing.Linear,{callback:function(){this.destroy()}}):this.animate({y:this.p.y+15},.8,t.Easing.Linear,{callback:function(){var e=i>=4?"mosking_anim":"mosking_hurt";if(3===i&&playBGM(bgm_heartbeat_slow,1,!1),this.stage.insert(new t.MosKing({x:this.p.x,y:a,sheet:e,scale:1})),i%2===0){var n=Math.round(2*Math.random()+1);t.audio.play("mosking_scream.mp3"),t("MosKingAttack").trigger("move"),mosBloodEnter(this.stage,n,220)}this.destroy()}})},opacity_0:function(){this.animate({opacity:0},.1,t.Easing.Quadratic.InOut,{callback:function(){this.opacity_1()}})},opacity_1:function(){this.animate({opacity:1},.1,t.Easing.Linear,{callback:function(){this.opacity_0()}})}}),t.Sprite.extend("MosKingAttack",{init:function(i){this._super(i,{sheet:"moskingattack_"+i.mosType,sprite:"moskingattack",k_attackId:GAME.ENEMY.k_attackId,live:5,opacity:0}),this.add("tween,animation"),this.animate({opacity:1},.6,t.Easing.Quadratic.InOut),this.on("hit",this,"collide"),this.on("disappear , attacked , call , move"),GAME.ENEMY.k_attack_5.push(this.p.k_attackId),GAME.ENEMY.k_attackId++;var a=this;GAME.ENEMY.k_attackTimer.push(setInterval(function(){if(t.state.get("is_video_over")&&t.state.get("is_countdown_over")&&t.state.get("mosking_life")>=0){var e=Math.round(Math.random()*GAME.ENEMY.RATE_moskingAttack),i=t.select("Player").items[0].p.x,n=t.select("Player").items[0].p.y,s=i-a.c.x,o=n-a.c.y,r=Math.atan2(o,s)/Math.PI*180;1==e&&a.stage.insert(new t.MosAttack({x:a.c.x,y:a.c.y,vx:s>0?10:-10,vy:(s>0?10:-10)*o/s,angle:r-90}))}},e))},call:function(){GAME.ENEMY.k_attack_5.includes(this.p.k_attackId)&&(this.c.y+=30)},move:function(){this.animate({y:this.p.y+60},.5,t.Easing.Quadratic.InOut)},collide:function(e){e.obj.isA("Player")&&(t.state.get("isPlayerAttack")||(t("Player").trigger("hurt"),t.state.dec("lives",1)),this.play("disappear"),clearInterval(GAME.ENEMY.k_attackTimer[this.p.k_attackId]))},attacked:function(){this.p.live--,0==this.p.live&&(t.audio.play("blood_bubble_broken.mp3"),this.play("disappear"),dropKatha(this.stage,this,10),clearInterval(GAME.ENEMY.k_attackTimer[this.p.k_attackId]))},disappear:function(){this.destroy()},step:function(){this.p.y>t.height&&this.destroy(),t.state.get("mosking_life")<0&&this.play("disappear")}})},Quintus.KathaSprites=function(t){t.gravityY=0,t.gravityX=0,t.Sprite.extend("Katha_1",{init:function(e){this._super(e,{sheet:"katha_1",sprite:"katha_1",collisionMask:t.SPRITE_ENEMY,vy:50}),this.add("2d"),this.on("hit",this,"collide"),this.on("destroy")},step:function(e){this.p.y+=this.p.vy*e,this.stage.collide(this),this.p.y>t.height&&this.destroy()},collide:function(e){(e.obj.isA("Power")||e.obj.isA("Player")||e.obj.isA("PlayerInvincible"))&&(this.destroy(),stageStop(),t.state.set("katha",1),t.stageScene("katha"),t("Power").trigger("power_up"))}}),t.Sprite.extend("Katha_2",{init:function(e){this._super(e,{sheet:"katha_2",sprite:"katha_2",collisionMask:t.SPRITE_ENEMY,vy:50}),this.add("2d"),this.on("hit",this,"collide"),this.on("destroy")},step:function(e){this.p.y+=this.p.vy*e,this.stage.collide(this),this.p.y>t.height&&this.destroy()},collide:function(e){(e.obj.isA("Power")||e.obj.isA("Player")||e.obj.isA("PlayerInvincible"))&&(this.destroy(),stageStop(),t.state.set("katha",2),t.stageScene("katha"),t("Player").trigger("player_speedUp"))}}),t.Sprite.extend("Katha_3",{init:function(e){this._super(e,{sheet:"katha_3",sprite:"katha_3",collisionMask:t.SPRITE_ENEMY,vy:50}),this.add("2d"),this.on("hit",this,"collide"),this.on("destroy")},step:function(e){this.p.y+=this.p.vy*e,this.stage.collide(this),this.p.y>t.height&&this.destroy()},collide:function(e){(e.obj.isA("Power")||e.obj.isA("Player")||e.obj.isA("PlayerInvincible"))&&(this.destroy(),stageStop(),t.state.set("katha",3),t.stageScene("katha"),t("Player").trigger("player_invincible"))}})},Quintus.LandingUI=function(t){t.Sprite.extend("Logo",{init:function(){this._super({x:t.width/2+10,y:150,opacity:1,asset:"logo.png"}),this.add("tween")}}),t.Sprite.extend("Background",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,cx:t.width/2,cy:t.height/2*3,asset:"landing/landing_bg_long.png",opacity:1,type:0}),this.add("tween")}}),t.Sprite.extend("Landing_start",{init:function(e){this._super(e,{asset:"landing/landing_btn_start.png",x:t.width/2,y:300,opacity:1,scale:1,type:t.SPRITE_UI}),this.add("tween"),this.on("touch")},touch:function(){button_click(this)}}),t.Sprite.extend("Landing_player",{init:function(e){this._super(e,{asset:"landing/landing_btn_player.png",x:t.width/2,y:360,opacity:1,scale:1,type:t.SPRITE_UI}),this.add("tween"),this.on("touch")},touch:function(){button_click(this)}}),t.Sprite.extend("IntroBg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,asset:"landing/intro_bg.png",opacity:1}),this.add("tween")}}),t.Sprite.extend("IntroMan",{init:function(e){this._super(e,{x:t.width/2+5,y:t.height-100,asset:"landing/intro_man.png",scale:.1}),this.add("tween"),this.animate({scale:1},.3,t.Easing.Quadratic.InOut)}}),t.UI.Text.extend("IntroText",{init:function(){this._super({label:"               天地不仁，以萬物為芻狗。\n吾號掌蚊人，生逢亂世，慘遭「登革熱」\n危害，為了傷其根，斬其源，吾將自己\n逼進死關，為的就是完成降蚊十八招大成。\n\n        時間只有五分鐘，戰友們！衝吧！",align:"left",x:80,y:150,weight:"normal",color:"#fffaf0",family:"Arial,微軟正黑體,sans-serif",size:20,opacity:0}),this.add("tween"),this.animate({opacity:1},.5,t.Easing.Linear)}}),t.Sprite.extend("IntroGo",{init:function(e){this._super(e,{x:t.width/2-70,y:t.height/2+55,asset:"landing/intro_btn_go.png",opacity:0,scale:1,type:t.SPRITE_UI}),this.add("tween"),this.on("touch"),this.animate({opacity:1},.5,t.Easing.Quadratic.InOut)},touch:function(){button_click(this)}}),t.Sprite.extend("IntroHowplay",{init:function(e){this._super(e,{x:t.width/2+70,y:t.height/2+55,asset:"landing/intro_btn_howplay.png",opacity:0,scale:1,type:t.SPRITE_UI}),this.add("tween"),this.on("touch"),this.animate({opacity:1},.5,t.Easing.Quadratic.InOut)},touch:function(){button_click(this)}}),t.Sprite.extend("PlayerRight",{init:function(e){this._super(e,{sheet:"player_right",sprite:"player_right",x:t.width/2+25,y:t.height-25,type:t.SPRITE_UI}),this.add("animation")}}),t.Sprite.extend("PlayerLeft",{init:function(e){this._super(e,{sheet:"player_left",sprite:"player_left",x:t.width/2-25,y:t.height-25,type:t.SPRITE_UI}),this.add("animation")}}),t.Sprite.extend("PlayerBack",{init:function(e){this._super(e,{sheet:"player_back",sprite:"player_back",x:t.width-60,y:t.height-20,type:t.SPRITE_UI,opacity:1,scale:1}),this.add("tween"),this.on("touch")},touch:function(){button_click(this)}}),t.Sprite.extend("PlayerManBg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,asset:"player/player_man_bg.png",type:t.SPRITE_UI}),this.add("tween")}}),t.Sprite.extend("PlayerManRotate",{init:function(e){this._super(e,{sheet:"player_man_rotate",sprite:"player_man_rotate",x:t.width/2+10,y:t.height-160}),this.add("animation"),this.on("rotate")},rotate:function(){t.audio.play("player_ha.mp3"),this.play("rotate")}}),t.Sprite.extend("PlayerManMan",{init:function(e){this._super(e,{sheet:"player_man_man",sprite:"player_man_man",x:t.width/2,y:t.height/2-10}),this.add("animation"),this.play("default"),this.on("startRotate")},startRotate:function(){t("PlayerManRotate").trigger("rotate")}}),t.Sprite.extend("PlayerManText1",{init:function(e){this._super(e,{asset:"player/player_man_text1.png",x:t.width/2-140,y:t.height/2-70,type:t.SPRITE_UI,scale:4,opacity:1}),t.audio.play("kick.mp3"),text1=this,this.add("tween"),this.animate({scale:1},.2,t.Easing.Quadratic.InOut,{callback:function(){window.setTimeout(function(){text1.stage.insert(new t.PlayerManText2)},300),this.animate({opacity:0},.4,t.Linear,{delay:.6,callback:function(){this.destroy()}})}})}}),t.Sprite.extend("PlayerManText2",{init:function(e){this._super(e,{asset:"player/player_man_text2.png",x:t.width/2+150,y:t.height/2-40,type:t.SPRITE_UI,scale:4,opacity:1}),t.audio.play("kick.mp3"),text2=this,this.add("tween"),this.animate({scale:1},.2,t.Easing.Quadratic.InOut,{callback:function(){window.setTimeout(function(){text2.stage.insert(new t.PlayerManText3)},300),this.animate({opacity:0},.4,t.Linear,{delay:.6,callback:function(){this.destroy()}})}})}}),t.Sprite.extend("PlayerManText3",{init:function(e){this._super(e,{asset:"player/player_man_text3.png",x:t.width/2-120,y:t.height/2+10,type:t.SPRITE_UI,scale:4,opacity:1}),t.audio.play("kick.mp3"),text3=this,this.add("tween"),this.animate({scale:1},.2,t.Easing.Quadratic.InOut,{callback:function(){window.setTimeout(function(){text3.stage.insert(new t.PlayerManText4)},300),this.animate({opacity:0},.4,t.Linear,{delay:.6,callback:function(){this.destroy()}})}})}}),t.Sprite.extend("PlayerManText4",{init:function(e){this._super(e,{asset:"player/player_man_text4.png",x:t.width/2+100,y:t.height/2+70,type:t.SPRITE_UI,scale:4,opacity:1}),t.audio.play("kick.mp3"),this.add("tween"),this.animate({scale:1},.2,t.Easing.Quadratic.InOut,{callback:function(){this.animate({opacity:0},.4,t.Linear,{delay:.6,callback:function(){this.destroy()}})}})}}),t.Sprite.extend("PlayerMoskingBg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,asset:"player/player_mosking_bg.png",type:t.SPRITE_UI}),this.add("tween")}}),t.Sprite.extend("PlayerMoskingRotate",{init:function(e){this._super(e,{sheet:"player_mos_rotate",sprite:"player_mos_rotate",x:t.width/2,y:t.height-160}),this.add("animation"),this.play("rotate")}}),t.Sprite.extend("PlayerMosking",{init:function(e){this._super(e,{sheet:"mosking",sprite:"mosking",x:t.width/2,y:t.height/2-10}),this.add("tween"),this.fly_up()},fly_up:function(){this.animate({y:t.height/2-15},.7,t.Easing.Quadratic.InOut,{callback:function(){this.fly_down()}})},fly_down:function(){this.animate({y:t.height/2-8},.5,t.Easing.Linear,{callback:function(){this.fly_up()}})}}),t.Sprite.extend("PlayerMosGBg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,asset:"player/player_mosG_bg.png"})}}),t.Sprite.extend("PlayerMosG",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2-10,asset:"player/player_mos.png",type:t.SPRITE_UI}),this.add("tween"),this.fly_up()},fly_up:function(){this.animate({y:t.height/2-18},.5,t.Easing.Quadratic.InOut,{callback:function(){this.fly_down()}})},fly_down:function(){this.animate({y:t.height/2-5},.5,t.Easing.Quadratic.InOut,{callback:function(){this.fly_up()}})}}),t.Sprite.extend("PlayerMosBg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,asset:"player/player_mos_bg.png"})}}),t.Sprite.extend("PlayerMos",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2-10,asset:"player/player_mos.png",type:t.SPRITE_UI}),this.add("tween"),this.fly_up()},fly_up:function(){this.animate({y:t.height/2-18},.5,t.Easing.Quadratic.InOut,{callback:function(){this.fly_down()}})},fly_down:function(){this.animate({y:t.height/2-5},.5,t.Easing.Quadratic.InOut,{callback:function(){this.fly_up()}})}}),t.Sprite.extend("GameDescription_bg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,opacity:0,scale:.1,asset:"landing/game_description_bg.png"}),this.add("tween"),this.animate({scale:1,opacity:1},.3,t.Easing.Quadratic.InOut)}})},Quintus.LevelUI=function(t){var e,i;t.Sprite.extend("Level_bg",{init:function(e){this._super(e,{x:t.width/2,y:t.height/2,opacity:1,asset:"level/level_bg.png",type:t.SPRITE_UI}),this.add("tween"),this.on("touch")},touch:function(e){if(t.state.get("is_countdown_over")&&!t.state.get("isLevelStop")&&t.state.get("mosking_life")>=0&&t.state.get("lives")>0){var i=t.select("Player").items[0].p.x,a=t.select("Player").items[0].p.y-70,n=e.x-i,s=e.y-a,o=Math.atan2(s,n)/Math.PI*180,r=t.state.get("power_up");r>0?(sheet="power_up",this.stage.insert(new t.PrePowerUp({x:i+15,y:a+20})),t.audio.play("powerUp.mp3")):(sheet="power",this.stage.insert(new t.PrePower({x:i+15,y:a+10}))),this.stage.insert(new t.Power({sheet:sheet,x:i+20,y:a,vx:n,vy:s,angle:o+90}))}}}),t.Sprite.extend("Life",{init:function(e){this._super(e,{sheet:"life",sprite:"life",y:t.height-15,type:t.SPRITE_UI})}}),t.Sprite.extend("Lives_text",{init:function(){this._super({sheet:"life_text",sprite:"life_text",x:70,y:t.height-15}),e=t.state.get("lives"),this.on("inserted",this,"initLives"),t.state.on("change.lives",this,"setLives")},initLives:function(){for(var i=20,a=1;e>=a;a++)GAME.PLAYER.life.push(this.stage.insert(new t.Life({x:90+i*a})))},setLives:function(){e=t.state.get("lives"),GAME.PLAYER.life[e].destroy(),GAME.PLAYER.life.pop(),0>=e&&(t.stage().trigger("lose"),t("MosAttack").trigger("disappear"),t("Player").trigger("destroy"),stopBGM(t.state.get("whichBGM")),playBGM(bgm_lose),resetAttackTimer())}}),t.Sprite.extend("Countdown_three",{init:function(e){this._super(e,{x:-100,y:0,sheet:"three_dark"}),this.add("tween"),this.animate({},1,t.Easing.Linear,{callback:function(){this.light()}})},light:function(){t.audio.play("countdown.mp3"),this.p.sheet="three_bright"}}),t.Sprite.extend("Countdown_two",{init:function(e){this._super(e,{x:0,y:0,sheet:"two_dark"}),this.add("tween"),this.animate({},2,t.Easing.Linear,{callback:function(){this.light()}})},light:function(){t.audio.play("countdown.mp3"),this.p.sheet="two_bright"}}),t.Sprite.extend("Countdown_one",{init:function(e){this._super(e,{x:100,y:0,sheet:"one_dark"}),this.add("tween"),this.animate({},3,t.Easing.Linear,{callback:function(){this.light()}})},light:function(){t.audio.play("countdown.mp3"),this.p.sheet="one_bright",this.animate({},1,t.Easing.Linear,{callback:function(){this.stage.trigger("countdown_over"),t.audio.play("countdown_final.mp3")}})}}),t.Sprite.extend("LevelStop_btn",{init:function(e){this._super(e,{sheet:"level_stop",x:t.width-30,y:t.height-15,opacity:1,scale:1,type:t.SPRITE_UI}),this.on("touch"),this.add("tween")},touch:function(){t.state.get("isLevelStop")||(t.state.get("is_countdown_over")||t.clearStage(3),t.audio.play("click.mp3"),button_click(this),stopBGM(t.state.get("whichBGM"),"continue"),t.state.set("isLevelStop",!0),stageStop(),i=this.stage.insert(new t.UI.Container({fill:"rgba(0,0,0,0.6)",border:"5",shadowColor:"rgba(0,0,0,0.5)",w:t.width,h:t.height,x:t.width/2,y:t.height/2})),this.stage.insert(new t.LevelContinue_btn,i),this.stage.insert(new t.LevelGoTitle_btn,i))}}),t.Sprite.extend("LevelContinue_btn",{init:function(e){this._super(e,{sheet:"level_continue",x:0,y:-30,opacity:1,scale:1,type:t.SPRITE_UI}),this.on("touch"),this.add("tween")},touch:function(){t.state.get("is_countdown_over")||t.stageScene("countdown"),t.audio.play("click.mp3"),button_click(this),playBGM(t.state.get("whichBGM")),t.state.get("isLevelStop")===!0&&(t.state.set("isLevelStop",!1),i.destroy(),stageContinue())}}),t.Sprite.extend("LevelGoTitle_btn",{init:function(e){this._super(e,{sheet:"level_goTitle",x:0,y:30,opacity:1,scale:1,type:t.SPRITE_UI}),this.on("touch"),this.add("tween")},touch:function(){t.audio.play("click.mp3"),button_click(this),stopBGM(t.state.get("whichBGM")),reset(),t.stageScene("title"),this.container.destroy()}}),t.UI.Text.extend("Level",{init:function(){this._super({label:"Level: 1",align:"right",level:1,x:t.width-70,y:t.height-10,weight:"normal",size:18}),t.state.on("change.level",this,"level")},level:function(t){this.p.label="level: "+t}}),t.Sprite.extend("Katha_1_bg",{init:function(e){this._super(e,{x:t.width/2,y:-300,asset:"katha/katha_1_bg.png",type:0}),this.add("tween"),this.animate({y:t.height/2},.3,t.Easing.Linear)}}),t.Sprite.extend("Katha_1_title",{init:function(e){this._super(e,{x:t.width/2+10,y:t.height/2-60,asset:"katha/katha_1_title.png",type:0,opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_1_text",{init:function(e){this._super(e,{label:"功法：\n1. 在家中裝紗窗、紗門，不讓蚊蟲進屋，睡覺時掛蚊帳。\n2. 使用捕蚊燈電蚊拍，陰暗處或是地下室定期巡邏。\n3. 若有放在戶外的廢棄輪胎、積水容器等物品馬上清除。",align:"left",x:80,y:240,weight:"300",family:"Arial,微軟正黑體,sans-serif",opacity:0,size:16}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_1_function",{init:function(e){this._super(e,{label:"效果：\n    召喚大魔導彈攻擊，持續 10 秒。",align:"left",x:100,y:330,weight:"300",size:16,family:"Arial,微軟正黑體,sans-serif",color:"darkred",opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.Sprite.extend("Katha_close_btn",{init:function(e){this._super(e,{x:t.width-100,y:t.height/2+70,asset:"katha/katha_close.png",opacity:0,type:t.SPRITE_UI}),this.add("tween"),this.on("touch"),this.animate({opacity:1},.3,t.Linear,{delay:.3})},touch:function(){button_click(this)}}),t.Sprite.extend("Katha_2_bg",{init:function(e){this._super(e,{x:t.width/2,y:-300,asset:"katha/katha_2_bg.png",type:0}),this.add("tween"),this.animate({y:t.height/2},.3,t.Easing.Linear)}}),t.Sprite.extend("Katha_2_title",{init:function(e){this._super(e,{x:t.width/2+10,y:t.height/2-60,asset:"katha/katha_2_title.png",type:0,opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_2_text",{init:function(e){this._super(e,{label:"功法：\n1. 清除不需要的容器，像花瓶、瓶蓋、缸盆、保麗龍\n、餅乾盒等，減少垃圾。\n2. 把暫時不需要用的容器「倒放」，以免積水。",align:"left",x:80,y:240,weight:"300",family:"Arial,微軟正黑體,sans-serif",opacity:0,size:16}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_2_function",{init:function(e){this._super(e,{label:"效果：\n    移動速度升為 300%，持續 10 秒。",align:"left",x:100,y:330,weight:"300",size:16,family:"Arial,微軟正黑體,sans-serif",color:"darkred",opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.Sprite.extend("Katha_3_bg",{init:function(e){this._super(e,{x:t.width/2,y:-300,asset:"katha/katha_3_bg.png",type:0}),this.add("tween"),this.animate({y:t.height/2},.3,t.Easing.Linear)}}),t.Sprite.extend("Katha_3_title",{init:function(e){this._super(e,{x:t.width/2+10,y:t.height/2-60,asset:"katha/katha_3_title.png",type:0,opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_3_text",{init:function(e){this._super(e,{label:"功法：\n1. 常洗澡，保持皮膚清爽。\n2. 在戶外或蚊蟲多的地方，盡量穿淺色長袖衣褲。\n3. 多吃洋蔥、大蒜、高麗菜、綠花椰菜，蚊子遠離你。",align:"left",x:80,y:240,family:"Arial,微軟正黑體,sans-serif",weight:"300",opacity:0,size:16}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}}),t.UI.Text.extend("Katha_3_function",{init:function(e){this._super(e,{label:"效果：\n    就是「無敵」，持續 6.666 秒。",align:"left",x:100,y:330,weight:"300",family:"Arial,微軟正黑體,sans-serif",color:"darkred",size:16,opacity:0}),this.add("tween"),this.animate({opacity:1},.3,t.Linear,{delay:.4})}})},Quintus.PlayerSprites=function(t){t.gravityY=0,t.gravityX=0;var e=10;t.Sprite.extend("Player",{init:function(e){this._super(e,{sheet:"player",sprite:"player",type:t.SPRITE_ENEMY,opacity:1,x:t.width/2,y:470}),t.state.set("player_h",this.p.h),this.add("tween"),this.on("player_speedUp , player_invincible , player_recover, hurt , destroy")},step:function(){var e=this.p.w/2;t.inputs.A?(this.p.x-=GAME.PLAYER.moveSpeed,this.p.x<e&&(this.p.x=e)):t.inputs.D&&(this.p.x+=GAME.PLAYER.moveSpeed,this.p.x>t.width-e&&(this.p.x=t.width-e)),0==t("Enemy").length&&(t.state.get("isMosenter")||(GAME.PLAYER.mos_addCount>0?(t("MosAttack").trigger("destroy"),t.state.inc("isMosenterScene",1),t.stageScene("mosEnter"),GAME.PLAYER.mos_addCount--):0==GAME.PLAYER.mos_addCount&&0==t("Enemy").length&&(this.stage.insert(new t.MosKing),stopBGM(t.state.get("whichBGM")),mosBloodEnter(this.stage,1,220),GAME.PLAYER.mos_addCount--,playVideo(GAME.VIDEO.mosking_appear,2))))},hurt:function(){t.audio.play("player_hurt.mp3");var e=8;t.state.set("isPlayerAttack",!0),this.twinkle_opacity_0(e)},twinkle_opacity_0:function(e){if(e>0)e--,this.animate({opacity:0},.1,t.Easing.Quadratic.InOut,{callback:function(){this.twinkle_opacity_1(e)}});else switch(t.state.set("isPlayerAttack",!1),t.state.get("lives")){case 3:this.p.sheet="man_life_3",this.p.h=120,this.p.cy=60;break;case 2:this.p.sheet="man_life_2";break;case 1:this.p.sheet="man_life_1",this.p.cx=40,this.p.w=80,this.p.h=120;break;default:t.stageScene("gameOver")}},twinkle_opacity_1:function(e){this.animate({opacity:1},.1,t.Easing.Quadratic.InOut,{callback:function(){this.twinkle_opacity_0(e)}})},player_speedUp:function(){var e=this.p.x,i=this.p.y;GAME.PLAYER.moveSpeed=9,this.stage.insert(new t.PlayerSpeedUP({x:e,y:i+40}))},player_invincible:function(){var e=this.p.x,i=this.p.y;this.stage.insert(new t.PlayerInvincible({x:e,y:i+15}))},player_recover:function(){GAME.PLAYER.moveSpeed=3,t("PlayerSpeedUP").trigger("hidden_destroy")}}),t.Sprite.extend("PlayerSpeedUP",{init:function(e){this._super(e,{sheet:"player_speedup",sprite:"player_speedup",scale:.1,opacity:.1}),this.add("animation,tween"),this.animate({scale:1,opacity:1},.2,t.Easing.Linear),this.play("default"),this.on("hidden_destroy")},step:function(){t.state.get("mosking_life")<0||t.state.get("lives")<=0?this.destroy():this.p.x=t.select("Player").items[0].p.x},hidden_destroy:function(){this.animate({opacity:0},1,t.Easing.Linear,{callback:function(){this.destroy()}})}}),t.Sprite.extend("PlayerInvincible",{init:function(e){this._super(e,{sheet:"player_invincible",sprite:"player_invincible",opacity:0,type:t.SPRITE_ENEMY}),this.add("tween"),this.on("twinkle_show"),this.on("twinkle_hidden"),this.on("hidden_destroy"),this.animate({opacity:1},.3,t.Easing.Linear)},step:function(){t.state.get("mosking_life")<0||t.state.get("lives")<=0?this.destroy():this.p.x=t.select("Player").items[0].p.x},hidden_destroy:function(){e=15,this.twinkle_hidden()},twinkle_hidden:function(){e--,this.animate({opacity:0},.1,t.Easing.Linear,{callback:function(){this.twinkle_show()}})},twinkle_show:function(){e>0?this.animate({opacity:1},.1,t.Easing.Linear,{callback:function(){this.twinkle_hidden()}}):this.destroy()}}),t.Sprite.extend("Power",{init:function(e){this._super(e,{sprite:"power",collisionMask:t.SPRITE_DEFAULT,angle:0}),this.on("hit",this,"collide"),this.on("power_up,power_recover,disappear")},disappear:function(){this.destroy()},step:function(t){this.p.x+=this.p.vx*t,this.p.y+=this.p.vy*t,this.stage.collide(this)},collide:function(e){e.obj.isA("MosAttack")||e.obj.isA("MosKing")?(t.audio.play("power_collide.ogg",!0),this.destroy(),e.obj.trigger("destroy")):(e.obj.isA("Enemy")||e.obj.isA("MosKingAttack"))&&(t.audio.play("power_collide.ogg",!0),this.destroy(),e.obj.trigger("attacked"))},power_up:function(){t.state.set("power_up",1)},power_recover:function(){t.state.set("power_up",0)}}),t.Sprite.extend("PrePower",{init:function(e){this._super(e,{sheet:"pre_power",sprite:"pre_power",opacity:1}),this.add("animation,tween"),this.play("shoot"),this.animate({opacity:0},.3,t.Easing.Linear,{callback:function(){this.destroy()}})}}),t.Sprite.extend("PrePowerUp",{init:function(e){this._super(e,{sheet:"pre_power_up",sprite:"pre_power_up",y:370,opacity:1}),this.add("animation,tween"),this.play("shoot"),this.animate({opacity:0},.5,t.Easing.Linear,{callback:function(){this.destroy()}})}})},Quintus.WarLevels=function(t){var e=5,i=4,a=2,n=1,s=0;t.assets.level1=[[s,s,n,n,s,s],[n,n,n,n,n,n],[s,n,n,n,n,s]],t.assets.addMos_2=[[s,i,s,s,i,s],[a,s,a,a,s,a],[s,a,n,n,a,s],[n,a,s,s,a,n]],t.assets.addMos_3=[[i,s,a,a,s,i],[a,i,n,n,i,a],[s,a,s,s,a,s],[i,n,a,a,n,i],[s,n,n,n,n,s]],t.assets.addKingattack_s_1=[[s,e,s,e,e,e,e,e,e,s,e,s]],t.assets.addKingattack_s_2=[[e,s,e,s,s,e,s,e,e,s,e,e]],t.assets.addKingattack_s_3=[[s,e,e,e,s,s,e,s,s,e,e,e]]},Quintus.WarScenes=function(t){function e(e,i){var a;showBar(),i.insert(new t.Player),t.state.inc("isMosenterScene",1),t.state.set("isMosenter",!0),a=t.stage().insert(new t.Mos_magic_circle),a.animate({scale:1,opacity:1},.3,t.Easing.Quadratic.InOut,{callback:function(){this.stage.insert(new t.MosquitoTracker({data:t.asset(e),direct:"up",y:70})),this.animate({opacity:0},.5,t.Easing.Linear,{delay:.5,callback:function(){this.destroy(),t.state.set("isMosenter",!1)}})}})}var i;t.scene("title",function(e){t.state.reset({player_h:0,lives:4,level:0,katha:0,player_state:1,power_up:0,mosking_life:2,isPlayerAttack:!1,isStop:!1,iskatha1:!1,iskatha2:!1,iskatha3:!1,is_countdown_over:!1,is_video_over:!1,video_num:0,isMosenter:!1,isMosenterScene:0,winnerTime:0,whichBGM:bgm_opening}),GAME.VIDEO.isOpening===!1&&playBGM(bgm_opening,1);var i=e.insert(new t.Background),a=e.insert(new t.Logo),n=e.insert(new t.Landing_start),s=e.insert(new t.Landing_player);t.clearStage(1),setState("這是... 掌蚊的世界..."),n.on("touch",function(){t.audio.play("click.mp3"),stopBGM(t.state.get("whichBGM")),i.animate({cy:t.height/2},1,t.Easing.Quadratic.InOut,{callback:function(){window.setTimeout(function(){t.stageScene("introStory")},20)}}),a.animate({opacity:0},.5,t.Easing.Quadratic.InOut,{callback:function(){this.destroy()}}),n.animate({opacity:0},.5,t.Easing.Quadratic.InOut,{callback:function(){this.destroy()}}),s.animate({opacity:0},.5,t.Easing.Quadratic.InOut,{callback:function(){this.destroy()}})}),s.on("touch",function(){t.audio.play("click.mp3"),stopBGM(t.state.get("whichBGM")),i.animate({opacity:0},1,t.Easing.Quadratic.InOut,{callback:function(){a.destroy(),n.destroy(),s.destroy(),this.destroy()}}),a.animate({opacity:0},.5,t.Easing.Quadratic.InOut,{callback:function(){t.stageScene("introPlayerMan")}}),n.animate({opacity:0},.5,t.Easing.Quadratic.InOut),s.animate({opacity:0},.5,t.Easing.Quadratic.InOut)})}),t.scene("introStory",function(e){setState("記得先看「怎麼玩」，衝"),playBGM(bgm_ready_start,.4);var i=e.insert(new t.IntroBg),a=e.insert(new t.IntroMan),n=e.insert(new t.IntroText),s=e.insert(new t.IntroHowplay),o=e.insert(new t.IntroGo);s.on("touch",function(){t.audio.play("click.mp3"),t.stageScene("gameDescription")}),o.on("touch",function(){t.audio.play("click.mp3"),stopBGM(t.state.get("whichBGM")),i.animate({opacity:0},1,t.Easing.Linear,{callback:function(){n.destroy(),o.destroy(),s.destroy()}}),n.animate({opacity:0},.5,t.Easing.Linear,{callback:function(){t.stageScene("level1")}}),o.animate({opacity:0},.5,t.Easing.Linear),s.animate({opacity:0},.5,t.Easing.Linear),a.animate({scale:0},.3,t.Easing.Quadratic.InOut,{callback:function(){this.destroy()}})})}),t.scene("gameDescription",function(e){e.insert(new t.GameDescription_bg),e.insert(new t.UI.Text({label:"A鍵向左，D鍵向右",color:"black",x:100,y:150,weight:"normal",align:"left",family:"Arial,微軟正黑體,sans-serif",size:16})),e.insert(new t.UI.Text({label:"點擊左鍵發射氣功砲，\n打擊邪惡的蚊子大軍。",color:"black",x:100,y:190,weight:"normal",align:"left",family:"Arial,微軟正黑體,sans-serif",size:16})),e.insert(new t.UI.Text({label:"邪惡的白線斑蚊將以\n「血刺」攻擊玩家。",color:"black",x:100,y:345,weight:"normal",align:"left",family:"Arial,微軟正黑體,sans-serif",size:16})),e.insert(new t.UI.Text({label:"捲軸記載了掌蚊奧義，\n打開即可使用",color:"black",x:100,y:410,weight:"normal",align:"left",family:"Arial,微軟正黑體,sans-serif",size:16}));
var i=e.insert(new t.Sprite({x:t.width-120,y:t.height/2+190,asset:"katha/katha_close.png",type:t.SPRITE_UI}));i.on("touch",function(){t.audio.play("click.mp3"),t.clearStage(2)})},{stage:2}),t.scene("introPlayerMan",function(e){setState("請你聽我... 娓娓道來..."),playBGM(bgm_player_man),t.state.set("player_state",1),e.insert(new t.PlayerManBg),e.insert(new t.PlayerManRotate),e.insert(new t.PlayerManMan),e.insert(new t.PlayerManText1),t.stageScene("playerFooter"),console.log("Scene: introPlayerMan")}),t.scene("introPlayerMosking",function(e){playBGM(bgm_player_mosking),t.state.set("player_state",2),e.insert(new t.PlayerMoskingBg),e.insert(new t.PlayerMoskingRotate),e.insert(new t.PlayerMosking),t.stageScene("playerFooter"),console.log("Scene: introPlayerMosking")}),t.scene("introPlayerMosG",function(e){playBGM(bgm_player_mosG),t.state.set("player_state",3),e.insert(new t.PlayerMosGBg),e.insert(new t.PlayerMoskingRotate),e.insert(new t.PlayerMosG),t.stageScene("playerFooter"),console.log("Scene: introPlayerMosG")}),t.scene("introPlayerMos",function(e){playBGM(bgm_player_mos),t.state.set("player_state",4),e.insert(new t.PlayerMosBg),e.insert(new t.PlayerMoskingRotate),e.insert(new t.PlayerMos),t.stageScene("playerFooter"),console.log("Scene: introPlayerMos")}),t.scene("playerFooter",function(e){var i=t.state.get("player_state"),a=e.insert(new t.PlayerBack);right=e.insert(new t.PlayerRight),left=e.insert(new t.PlayerLeft),right.on("touch",function(){t.audio.play("click.mp3"),1==i?(stopBGM(bgm_player_man),t.stageScene("introPlayerMosking")):2==i?(stopBGM(bgm_player_mosking),t.stageScene("introPlayerMosG")):3==i?(stopBGM(bgm_player_mosG),t.stageScene("introPlayerMos")):4==i&&(stopBGM(bgm_player_mos),t.stageScene("introPlayerMan")),right.play("click")}),left.on("touch",function(){t.audio.play("click.mp3"),1==i?(stopBGM(bgm_player_man),t.stageScene("introPlayerMos")):2==i?(stopBGM(bgm_player_mosking),t.stageScene("introPlayerMan")):3==i?(stopBGM(bgm_player_mosG),t.stageScene("introPlayerMosking")):4==i&&(stopBGM(bgm_player_mos),t.stageScene("introPlayerMosG")),left.play("click")}),a.on("touch",function(){t.audio.play("click.mp3"),1===i?stopBGM(bgm_player_man):2===i?stopBGM(bgm_player_mosking):3===i?stopBGM(bgm_player_mosG):4===i&&stopBGM(bgm_player_mos),t.stageScene("title")})},{stage:1}),t.scene("mosEnter",function(e){var a=t.state.get("isMosenterScene");if(t.state.set("isMosenter",!0),e.insert(new t.Mosking_talk),e.insert(new t.Mosking_talk_frame),2==a){stopBGM(bgm_level1),playBGM(bgm_mos_appear);var n=e.insert(new t.Mosking_talk_text_2)}else if(3==a){stopBGM(bgm_mos_appear),playBGM(bgm_mosG_appear);var n=e.insert(new t.Mosking_talk_text_3)}n.animate({opacity:1},.3,t.Easing.Quadratic.InOut,{delay:.6,callback:function(){i.on("touch",function(){t.audio.play("click.mp3"),t.clearStage(4);var e=t.stage().insert(new t.Mos_magic_circle);e.animate({scale:1,opacity:1},.3,t.Easing.Quadratic.InOut,{callback:function(){this.stage.insert(new t.MosquitoTracker({data:t.asset("addMos_"+a),y:70,scale:1,direct:"up"})),3==a&&t.audio.play("mosG_scream.mp3"),this.animate({opacity:0},.5,t.Easing.Linear,{delay:.5,callback:function(){2==a&&t.audio.play("mos_scream.mp3"),this.destroy(),t.state.set("isMosenter",!1)}})}}),i.listeners.touch.pop()})}})},{stage:4}),t.scene("katha",function(e){var i,a=t.state.get("katha");t.state.set("isLevelStop",!0),t.audio.play("katha_drop.mp3"),1==a?(setState("一手遮蚊！"),e.insert(new t.Katha_1_bg),e.insert(new t.Katha_1_title),e.insert(new t.Katha_1_text),e.insert(new t.Katha_1_function),i=e.insert(new t.Katha_close_btn),t.state.set("iskatha1",!0)):2==a?(setState("縮文成吋！"),e.insert(new t.Katha_2_bg),e.insert(new t.Katha_2_title),e.insert(new t.Katha_2_text),e.insert(new t.Katha_2_function),i=e.insert(new t.Katha_close_btn),t.state.set("iskatha2",!0)):3==a&&(setState("防蚊神體！"),e.insert(new t.Katha_3_bg),e.insert(new t.Katha_3_title),e.insert(new t.Katha_3_text),e.insert(new t.Katha_3_function),i=e.insert(new t.Katha_close_btn),t.state.set("iskatha3",!0)),i.on("touch",function(){1==a?(t.audio.play("player_powerup.mp3"),window.setTimeout(function(){t("Power").trigger("power_recover"),t.state.set("iskatha1",!1)},1e4)):2==a?(t.audio.play("speedup.mp3"),window.setTimeout(function(){t("Player").trigger("player_recover"),t.state.set("iskatha2",!1)},1e4)):3==a&&(t.audio.play("player_invincible.mp3"),window.setTimeout(function(){t("PlayerInvincible").trigger("hidden_destroy"),t.state.set("iskatha3",!1)},6666)),t.state.set("katha",0),t.state.set("isLevelStop",!1),stageContinue(),t.audio.play("click.mp3"),t.clearStage(2)})},{stage:2}),t.scene("hud",function(e){e.insert(new t.Lives_text),e.insert(new t.LevelStop_btn)},{stage:1}),t.scene("countdown",function(e){var i=e.insert(new t.UI.Container({fill:"rgba(90,88,92,0.85)",shadowColor:"rgba(0,0,0,0.5)",w:t.width,h:120,x:-t.width/2,y:t.height/2-30}));i.add("tween"),i.animate({x:t.width/2},.2,t.Easing.Quadratic.InOut),e.insert(new t.Countdown_three,i),e.insert(new t.Countdown_two,i),e.insert(new t.Countdown_one,i),e.on("countdown_over",function(){var e;t.state.set("is_countdown_over",!0),e=t.state.get("video_num"),1===e?startClock(0):2===e&&startClock(getUsedTime()),t.clearStage(3)})},{stage:3}),t.scene("level1",function(a){setState("來決鬥吧！！"),i=a.insert(new t.Level_bg),t.state.set("level",1),t.state.set("isLevelStop",!1),t.stageScene("hud"),e("level1",a),playVideo(GAME.VIDEO.fight,1),a.on("complete",function(){i.animate({opacity:0},1.5,t.Easing.Linear,{delay:2,callback:function(){t.stageScene("winner")}})}),a.on("lose",function(){i.animate({opacity:0},1.5,t.Easing.Linear,{delay:1,callback:function(){t.stageScene("gameOver")}})})}),t.scene("gameOver",function(e){console.log("Scene: gameOver"),stopBGM(bgm_heartbeat_slow),e.insert(new t.Sprite({asset:"level/gameover_bg.png",x:t.width/2,y:t.height/2}));var i=e.insert(new t.Sprite({sheet:"level_goTitle_gameover",x:t.width/2,y:t.height/2-15,scale:1,opacity:1,type:t.SPRITE_UI})),a=e.insert(new t.Sprite({sheet:"level_goAgain_gameover",x:t.width/2,y:t.height/2+35,scale:1,opacity:1,type:t.SPRITE_UI}));i.add("tween"),a.add("tween"),i.on("touch",function(){button_click(this),stopBGM(bgm_lose),t.audio.play("click.mp3"),t.stageScene("title")}),a.on("touch",function(){button_click(this),stopBGM(bgm_lose),t.audio.play("click.mp3"),t.stageScene("level1")}),reset()}),t.scene("winner",function(e){var i=getUsedTime();stopBGM(bgm_mosking),stopBGM(bgm_heartbeat_slow),playBGM(bgm_winner),reset(),240>=i?(playVideo(GAME.VIDEO.winnerS,5),console.log(i)):270>=i?(playVideo(GAME.VIDEO.winnerA,4),console.log(i)):(playVideo(GAME.VIDEO.winnerB,3),console.log(i)),e.insert(new t.Sprite({asset:"level/winner_bg.png",x:t.width/2,y:t.height/2}));var a=e.insert(new t.Sprite({sheet:"level_goTitle_winner",x:t.width/2,y:t.height/2+100,opacity:1,scale:1,type:t.SPRITE_UI})),n=e.insert(new t.Sprite({sheet:"level_goFanspage_winner",x:t.width/2,y:t.height/2+150,opacity:1,scale:1,type:t.SPRITE_UI}));a.add("tween"),n.add("tween"),a.on("touch",function(){button_click(this),stopBGM(t.state.get("whichBGM")),t.audio.play("click.mp3"),t.stageScene("title")}),n.on("touch",function(){button_click(this),stopBGM(t.state.get("whichBGM")),t.audio.play("click.mp3"),t.stageScene("title"),window.open("https://www.facebook.com/themosquitoman/","_blank")})})},Quintus.WarSprites=function(t){t.gravityY=0,t.gravityX=0;var e,i=[],a=0,n=0,s=1500;t.TileLayer.extend("GameTiles",{init:function(){this._super({dataAsset:"level.tmx",sheet:"all",tileW:10,tileH:10,blockTileW:21,blockTileH:27})},load:function(e){for(var i=new DOMPaser,a=i.parseFromString(t.asset(e),"application/xml"),n=a.getElementByTagName("layer")[0],s=parseInt(n.getAttribute("width")),o=parseInt(n.getAttribute("height")),r=[],h=n.getElementsByTagName("all"),c=0,l=0;o>l;l++){r[l]=[];for(var p=0;s>p;p++){var y=h[c];r[l].push(parseInt(y.getAttribute("gid")-1)),c++}}this._super(r)},collidableTile:function(t){return 23!=t}}),t.Sprite.extend("MosquitoTracker",{init:function(e){this._super(e,{x:t.width/2,y:30,scale:.1,count:0}),this.add("tween"),this.animate({scale:1},.4,t.Easing.Quadratic.InOut),this.on("inserted",this,"setupBlocks")},setupBlocks:function(){t._each(this.p.data,function(e,i){t._each(e,function(a,n){a&&this.stage.insert(new t.Enemy({num:a,x:80*n-80*(e.length/2-.5),y:50*i}),this)},this)},this)},step:function(){this.p.count++,this.p.count%120==0&&(this.p.y+=20,this.c.y+=20,this.p.count=0)}}),t.Sprite.extend("Enemy",{init:function(e){this._super(e,{sheet:"enemy",sprite:"enemy",collisionMask:t.SPRITE_ENEMY,mosId:a,opacity:1}),this.add("tween"),a++;var n=this;i.push(setInterval(function(){var e=Math.round(6*Math.random());player_x=t.select("Player").items[0].p.x,player_y=t.select("Player").items[0].p.y,vx=player_x-n.c.x,vy=player_y-n.c.y,angle=Math.atan2(vy,vx)/Math.PI*180,1==e&&t("MosAttack").length<10&&n.stage.insert(new t.MosAttack({x:n.c.x,y:n.c.y,vx:vx>0?10:-10,vy:(vx>0?10:-10)*vy/vx,angle:angle-90}))},s))},destroyed:function(){this.p.sheet="enemy_death",clearInterval(i[this.p.mosId]),t.state.inc("score",100);var e=Math.round(15*Math.random());1==e&&0==t("Katha_1").length&&this.stage.insert(new t.Katha_1({x:this.c.x,y:this.c.y})),this.animate({y:this.p.y+15,opacity:0},.3,t.Easing.Linear,{callback:function(){this.destroy()}})}}),t.Sprite.extend("Player",{init:function(i){this._super(i,{sheet:"player",sprite:"player",type:t.SPRITE_ENEMY,x:t.width/2,y:450,katha:0}),e=this.p.h},step:function(){var e=this.p.w/2;t.inputs.left?(this.p.x-=5,this.p.x<e&&(this.p.x=e)):t.inputs.right&&(this.p.x+=5,this.p.x>t.width-e&&(this.p.x=t.width-e)),t("Enemy").length<5&&(n>0&&(this.stage.insert(new t.MosquitoTracker({data:t.asset("addRow"),y:0,scale:1})),n--),0==n&&0==t("Enemy").length&&this.stage.insert(new t.MosKing))}}),t.Sprite.extend("Power",{init:function(e){this._super(e,{sprite:"power",collisionMask:t.SPRITE_DEFAULT,angle:0}),this.on("hit",this,"collide"),this.on("power_up"),this.on("power_recover")},step:function(t){this.p.x+=this.p.vx*t,this.p.y+=this.p.vy*t,this.stage.collide(this)},collide:function(e){(e.obj.isA("Enemy")||e.obj.isA("MosAttack")||e.obj.isA("MosKing"))&&(t.play("brickDeath.ogg"),e.obj.destroyed(),this.destroy())},power_up:function(){console.log("power_up"),t.state.set("power_up",1)},power_recover:function(){console.log("power_recover"),t.state.set("power_up",0)}}),t.Sprite.extend("PrePower",{init:function(e){this._super(e,{sheet:"pre_power",sprite:"pre_power",opacity:1}),this.add("animation,tween"),this.play("shoot"),this.animate({opacity:0},.3,t.Linear,{callback:function(){this.destroy()}})}}),t.Sprite.extend("PrePowerUp",{init:function(e){this._super(e,{sheet:"pre_power_up",sprite:"pre_power_up",y:370,opacity:1}),this.add("animation,tween"),this.play("shoot"),this.animate({opacity:0},.5,t.Linear,{callback:function(){this.destroy()}})}}),t.Sprite.extend("MosKing",{init:function(e){this._super(e,{sheet:"mosking_anim",sprite:"mosking_anim",collisionMask:t.SPRITE_ENEMY,x:t.width/2,y:120,life:20})},destroyed:function(){this.p.life--,0==this.p.life&&(this.destroy(),this.stage.trigger("complete"))}}),t.Sprite.extend("MosAttack",{init:function(e){this._super(e,{sheet:"mosattack",sprite:"mosattack",collisionMask:t.SPRITE_ENEMY}),this.add("2d"),this.on("hit",this,"collide")},step:function(i){this.p.x+=this.p.vx*i,this.p.y+=this.p.vy*i,this.stage.collide(this),this.p.y>t.height-e+20&&this.destroy()},collide:function(e){e.obj.isA("Player")&&(this.destroy(),t.state.dec("lives",1))},destroyed:function(){this.destroy()}}),t.Sprite.extend("Katha_1",{init:function(e){this._super(e,{sheet:"katha_1",sprite:"katha_1",collisionMask:t.SPRITE_ENEMY,vy:50}),this.add("2d"),this.on("hit",this,"collide")},step:function(i){this.p.y+=this.p.vy*i,this.stage.collide(this),this.p.y>t.height-e+20&&this.destroy()},collide:function(e){(e.obj.isA("Power")||e.obj.isA("Player"))&&(this.destroy(),this.stage.pause(),t.state.set("katha",1),t.stageScene("katha"),t("Power").trigger("power_up"))},destroyed:function(){this.destroy()}})};