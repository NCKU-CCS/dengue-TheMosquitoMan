!function(t){function a(t,a,i){g.html(a),svg=d3.select("#bar").append("svg").attr("width","100%").attr("height",p+f.top+f.bottom).append("g").attr("transform","translate("+f.left+","+f.top+")").call(g),s=d3.scale.ordinal().rangeRoundBands([0,m],.55),o=d3.scale.linear().range([p,0]),d=d3.svg.axis().scale(s).orient("bottom").ticks(30),u=d3.svg.axis().scale(o).orient("left").ticks(10),s.domain(t.map(function(t){return t.city})),o.domain([0,d3.max(t,function(t){return t.value})]),n(),r(t),i&&(e(t,5,"五日移動平均線","#E10707",-10,m-100),e(t,10,"十日移動平均線","#15B321",-10,m-220))}function e(t,a,e,r,n,l){var d=i(a),u=d(t),c=d3.svg.line().interpolate("basis").x(function(t){return s(t.date)}).y(function(t){return o(t.value)});svg.append("path").datum(u).attr("class","line").attr("stroke",r).attr("d",c),svg.append("text").attr("transform","translate("+l+","+n+")").attr("dy",".35em").attr("text-anchor","start").style("fill",r).text(e)}function r(t){barWidth=m/26,barWidth<0&&(barWidth=1),svg.selectAll("bar").data(t).enter().append("rect").style("fill",function(){return"steelblue"}).attr("class",function(t){return t.drug_times>0?"in-drug-day":""}).on("mouseover",g.show).on("mouseout",g.hide).attr("x",function(t){return s(t.city)}).attr("width",barWidth).attr("y",function(){return p}).attr("height",0).transition().duration(400).delay(function(t,a){return 50*a}).attr("y",function(t){return o(t.value)}).attr("height",function(t){return p-o(t.value)})}function n(){c>500?svg.append("g").attr("class","x axis").attr("transform","translate(5.5,"+p+")").call(d).selectAll("text").style("text-anchor","end").attr("dx","1.5em").attr("dy","1em").attr("transform","rotate(0)"):svg.append("g").attr("class","x axis").attr("transform","translate(0,"+p+")").call(d).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy","-.55em").attr("transform","rotate(-65)").style("font-size",10),svg.append("g").attr("class","y axis").call(u).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("7日內病例數（人）")}function i(t){return function(a){return a=a.map(function(e,r,n){var i,s,o,d=r+t-1;return d<a.length?(i=n.slice(r,d+1),o=i[i.length-1],s=i.reduce(function(a,e){return l(a.date,e.date)<t?{value:a.value+e.value,date:o.date}:{value:a.value,date:o.date}}),{value:s.value/t,date:o.date}):void 0}),a=a.filter(function(t){return"undefined"!=typeof t})}}function l(t,a){var e=Math.abs(t.getTime()-a.getTime()),r=Math.ceil(e/864e5);return r}t.drawChart=a;var s,o,d,u,c=$("#bar").width(),f=(d3.time.format("%Y/%m/%d").parse,{top:20,right:20,bottom:70,left:40}),m=c-f.left-f.right,p=250,g=d3.tip().attr("class","d3-tip").offset([-10,0])}(window);